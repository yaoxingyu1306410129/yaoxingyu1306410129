!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="css/style.css"/>
	</head>

	<body>
		<script src="js/mui.min.js"></script>
		<header class="mui-bar mui-bar-nav">
		    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		    <a class="mui-icon mui-pull-right">
		    	<button class="btn">保存</button>
		    </a>
		    <h1 class="mui-title">个人信息</h1>
		</header>
		<div class="mui-content">
		    <div class="grxx-a">
		    	<ul class="mui-table-view" style="margin-bottom: 20px;">
		    	        <li class="mui-table-view-cell" style="border-bottom: 1px solid #D8D8D8;">
		    	            <a  id="xx">
		    	                <span>头像</span>
		    	                <img src="images/tx.png" id="img"/>
		    	            </a>
		    	        </li>
		    	        <li class="mui-table-view-cell" style="border-bottom: 1px solid #D8D8D8;">
		    	            <a >
		    	                <span>昵称</span>
		    	                <input type="text" placeholder="请输入昵称" class="mui-pull-right" style="margin-right: 5px; width:120px ;border: 0px;text-align: right;font-size: 15px; padding: 0px;margin: 0px;height:20px;line-height:20px;"/>
		    	            </a>
		    	        </li>
		    	        <li class="mui-table-view-cell" style="border-bottom: 1px solid #D8D8D8;">
		    	            <a >
		    	                <span>ID</span>
		    	                <span class="mui-pull-right" style="margin-right: 5px; width:120px ;border: 0px;text-align: right; font-size: 12px;">2019604</span>
		    	            </a>
		    	        </li>
		    	        <li class="mui-table-view-cell" style="border-bottom: 1px solid #D8D8D8;">
		    	            <a  >
		    	                <span>等级</span>
		    	                <span class="mui-pull-right" style="margin-right: 5px; width:120px ;border: 0px;text-align: right; color: #00000;font-size: 12px;">LV1.填空新秀</span>
		    	            </a>
		    	        </li>
		    	        <li class="mui-table-view-cell" style="border-bottom: 1px solid #D8D8D8;">
		    	            <a >
		    	                <span>性别</span>
		    	                <input type="text" placeholder="性别" class="mui-pull-right" style="margin-right: 5px !important; width:120px ;border: 0px;text-align: right; font-size: 14px;padding: 0px;margin: 0px;height:20px;line-height:20px;"/>
		    	            </a>
		    	        </li>
		    	    </ul>
		    	    <ul class="mui-table-view">
		    	            <li class="mui-table-view-cell"style="border-bottom: 1px solid #D8D8D8;">
		    	                <a>
		    	                    <span>手机号码</span>
		    	                    <input type="text" placeholder="请输入手机号码" class="mui-pull-right" style="margin-right: 5px; width:120px ;border: 0px;text-align: right;font-size: 14px;padding: 0px;margin: 0px;height:20px;line-height:20px;"/>
		    	                </a>
		    	            </li>
		    	            <li class="mui-table-view-cell"style="border-bottom: 1px solid #D8D8D8;">
		    	                <a>
		    	                     <span>支付宝</span>
		    	                     <input  placeholder="请输入支付宝" class="mui-pull-right" style="margin-right: 5px; width:120px ;border: 0px;text-align: right;font-size: 14px ;padding: 0px;margin: 0px;height:20px;line-height:20px;"/>
		    	                </a>
		    	            </li>
		    	            <li class="mui-table-view-cell"style="border-bottom: 1px solid #D8D8D8;">
		    	                <a>
		    	                     <span>QQ号</span>
		    	                     <input type="text" placeholder="请输入QQ号" class="mui-pull-right" style="margin-right: 5px; width:120px ;border: 0px;text-align: right;font-size: 14px; padding: 0px;margin: 0px;height:20px;line-height:20px;"/>
		    	                </a>
		    	            </li>
		    	            <li class="mui-table-view-cell"style="border-bottom: 1px solid #D8D8D8;">
		    	                <a>
		    	                     <span>微信号</span>
		    	                     <input type="text" placeholder="请输入微信号" class="mui-pull-right" style="margin-right: 5px; width:120px ;border: 0px;text-align: right;font-size: 14px ;padding: 0px;margin: 0px;height:20px;line-height:20px;"/>
		    	                </a>
		    	            </li>
		    	        </ul>
		    </div>
		    <div class="grxx-b">
		    	<span>请及时填写正确的手机号码，打开软件推送，加入Q群等，以保证中奖信息可以第一时间通知到您。</span>
		    </div>
		    <p style="margin-top: 30px;margin-left: 10px;">零钱购不会将用户个人资料提供给第三人，或移作其他目的使用。</p>
		</div>
	</body>
	<script type="text/javascript" src="js/castapp.js" ></script>
	<script type="text/javascript">
		ca.init();
		var cell = ca.className('mui-table-view-cell');
		var img = ca.id('img');
		var btn = ca.className('btn')[0];
		var input = ca.tagName('input');
		var img_url = '';
		//先引入已有的数据；
		var user_data = JSON.parse(localStorage.getItem('user_data'));
//		alert(JSON.stringify(user_data.zfb));
		if (user_data.head_img) {
			img.src=user_data.head_img;
		} else{
			img.src="images/tx.png";
		}
		input[0].value = user_data.nickname ;
		input[1].value = user_data.sex;
		input[3].value = user_data.zfb;
		input[4].value = user_data.qq;
		input[5].value = user_data.wx;
		[5].value;
		cell[0].addEventListener('tap',function(){
			var arr = ['照相机','相册'];
			castapp.actionSheet(arr,{
				succFn:function(data){
					//上传后的图片路径
					img_url = 'http://peipao.dongyixueyuan.com/'+data;
					img.src=img_url;
				},
				errFn:function(data){
					alert(data);
				},
				//是否开启上传
				isUpload:true,
				//上传地址
				uploadUrl:'http://peipao.dongyixueyuan.com/upload_file.php',
				
			})
		});
		input[2].value =localStorage.getItem('login_phone') ;
		cell[4].addEventListener('tap',function(){
			var arr = ['男','女','秘密'];
			ca.actionSheet(arr,{
				succFn:function(data){
					input[1].value=arr[data];
				}
			})
		})
		btn.addEventListener('tap',function(){
			var nickname = input[0].value;
			if (nickname=='') {
				ca.prompt('请输入昵称')
				return;
			}
			var sex = input[1].value;
			var zfb = input[3].value;
			var qq = input[4].value;
			var wx = input[5].value;
			var request_url = localStorage.getItem('request_url');
			var login_phone = localStorage.getItem('login_phone');
			ca.get({
				url:request_url +'User/mod',
				data:{
					//修改的是谁？
					phone_data:login_phone,
					//都修改了什么？
					img_url_data:img_url,
					nickname_data : nickname,
					sex_data :sex,
					zfb_data:zfb,
					qq_data:qq,
					wx_data:wx,
				},
				succFn:function(data){
//					alert(data);
					if (data) {
						ca.prompt('修改成功');
						//通知我的界面
					var arr = ['wode'];
					ca.sendNotice(arr,'update_user_info',{});
					//关闭界面
					ca.closeCurrentInterface();
					} else{
						ca.prompt('修改失败');
					}
				}
			})
			
		})
		
	</script>

</html>